<div class="d-flex justify-content-between mb-4 align-items-center">
  <div class="divWithClass"></div>
  <h1 class="m-0" mat-dialog-title data-automation-id="scm-title">
    {{ isReadOnlyMode ? 'Send to Outbound Port' : 'Storage Container Management' }}
  </h1>
  <button mat-icon-button class="close-button dialog-close-button-fix" [mat-dialog-close]="false" data-automation-id="scm-close-btn">
    <mat-icon class="close-icon">close</mat-icon>
  </button>
</div>

<div>
  <div class="row">

    <div [ngClass]="isReadOnlyMode ? 'col-xl-6' : 'col-xl-5'">
      <mat-form-field class="custom-form-field w-100 mb-3" appearance="outline" data-automation-id="scm-zone-ff">
        <mat-label data-automation-id="scm-zone-lbl">Zone</mat-label>
        <mat-select *ngIf="!isReadOnlyMode" [(ngModel)]="scm.carouselZone" class="employees-action" [disabled]="checkDisabled('carouselZone')" autoFocus #zone (selectionChange)="zoneChanged()" data-automation-id="scm-zone-sel">
          <mat-option *ngFor="let option of carouselZones; let i = index" [value]="option" [attr.data-automation-id]="'scm-zone-opt-' + option.zone">
            {{ option.zone }}
          </mat-option>
        </mat-select>
        <input *ngIf="isReadOnlyMode" matInput [value]="scm.carouselZone.zone || zone" [disabled]="checkDisabled('carouselZone')" data-automation-id="scm-zone-readonly">
        <span *ngIf="!isReadOnlyMode" class="material-symbols-outlined icon-expand-more">expand_more</span>
      </mat-form-field>
    </div>

    <div [ngClass]="isReadOnlyMode ? 'col-xl-6' : 'col-xl-5'">
      <mat-form-field class="custom-form-field w-100 mb-3" appearance="outline" data-automation-id="scm-row-ff">
        <mat-label data-automation-id="scm-row-lbl">{{ data.rowFieldAlias }}</mat-label>
        <input matInput [(ngModel)]="scm.tray" [disabled]="checkDisabled('tray')" autoFocus #storageContainer (keydown.enter)="!isReadOnlyMode && handleEnter()" data-automation-id="scm-row-inp">
      </mat-form-field>
    </div>

    <div class="col-xl-2" *ngIf="!isReadOnlyMode">
      <button mat-mini-fab color="primary" [disabled]="checkDisabled('tray')" (click)="validateScannedContainer()" data-automation-id="scm-validate-btn">
        <mat-icon class="material-symbols-outlined icon-expand-more">check</mat-icon>
      </button>
    </div>

    <div class="col-xl-12">
      <mat-form-field class="custom-form-field w-100 mb-3" appearance="outline" data-automation-id="scm-type-ff">
        <mat-label data-automation-id="scm-type-lbl">Container Type</mat-label>
        <mat-select *ngIf="!isReadOnlyMode" [(ngModel)]="scm.containerType"
                    #containerTypeDropdown
                    class="employees-action"
                    [disabled]="checkDisabled('containerType')"
                    (selectionChange)="containerTypeChanged()" data-automation-id="scm-ff-select">
          <mat-option *ngFor="let option of containerTypes; let i=index" [value]="option.id" [attr.data-automation-id]="'scm-type-opt-' + option.name">
            {{ option.name }}
          </mat-option>
        </mat-select>
        <input *ngIf="isReadOnlyMode" matInput [value]="getContainerTypeName()" [disabled]="checkDisabled('containerType')" data-automation-id="scm-type-readonly">
        <span *ngIf="!isReadOnlyMode" class="material-symbols-outlined icon-expand-more">expand_more</span>
      </mat-form-field>
    </div>

    <div class="col-xl-12" *ngIf="scm.containerType != 0 || isReadOnlyMode">
      <div class="d-flex align-items-center text-tertary-900 mb-2 text-14 lh-24" data-automation-id="scm-info-msg">
        <mat-icon class="material-symbols-outlined text-18 text-tertary-900 lh-24">info</mat-icon>
        <div *ngIf="!isReadOnlyMode">{{ inventoryMapRecords.count }} Inventory map {{ inventoryMapRecords.label }} with Bin</div>
        <div *ngIf="isReadOnlyMode">{{ totalRecordsToRemove }} Inventory map records with Bin</div>
      </div>
      <table class="w-100 br-20 overflow-hidden mb-2" data-automation-id="scm-table">
        <tr *ngFor="let row of tableMatrix; let rowIdx = index">
          <td *ngFor="let cell of row; let colIdx = index" 
              class="p-4 text-center" 
              [ngClass]="{
                'bg-primary-10 text-chrome-600': !isReadOnlyMode || !hasCellConstraints(cell),
                'cart-management-multiline-tooltip label-red': isReadOnlyMode && hasCellConstraints(cell)
              }"
              matTooltipPosition="above"
              [matTooltip]="isReadOnlyMode && hasCellConstraints(cell) ? getCellConstraintsTooltip(cell) : ''"
              matTooltipClass="cart-management-multiline-tooltip"
              [attr.data-automation-id]="'scm-table-cell-' + (cell || '-')">
            {{ cell || '-' }}
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

<mat-dialog-actions>
  <button *ngIf="!isReadOnlyMode" id="saveBtn" type="submit" mat-flat-button class="btn-lg flex-grow-1" color="primary" [disabled]="checkDisabled('save')" (click)="save()" data-automation-id="scm-save-btn">Save</button>
  <button *ngIf="isReadOnlyMode" type="submit" mat-flat-button class="btn-lg flex-grow-1" color="primary" [disabled]="checkDisabled(storageContainerDisabledFields.SENDTOOUTBOUNDPORT)" (click)="proceedToRemovalConfirmation()" data-automation-id="scm-send-outbound-btn">Proceed</button>
</mat-dialog-actions>
