<mat-card class="mat-elevation-z g-card mb-4">
  <mat-card-content >
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center">
        <app-icon-heading-component 
          icon="shelves" 
          heading="Cart Management" 
          [automationId]="'cart-management-title'">
        </app-icon-heading-component>
      </div>
      <button mat-stroked-button
              color="primary" 
              class="btn-regular"
              [disabled]="isAddDisabled()"
              (click)="onAddNewCart()"
              data-automation-id="add-new-cart-btn">
        Add New Cart
      </button>
      </div>
      <div class="d-block d-xl-flex gap-12 align-items-center">
        <app-column-filter-component 
          [tableColumns]="tableColumns" 
          [searchCol]="selectedColumn"
          (selectionChangeEvent)="onColumnSelectionChange($event)"
          (clearInputFieldEvent)="onClearSearch()"
          [searchString]="searchTerm"
          [searchByInput]="searchByInput"
          [searchAutocompleteList]="searchAutocompleteList"
          (autoCompleteEvent)="onSearchInput($event)"
          (optionSelectedEvent)="onOptionSelected($event)"
          data-automation-id="cart-column-filter-component">
        </app-column-filter-component>
    </div>
    
    <!-- Applied Filters Display -->
    <app-applied-filters-display
      [appliedFilters]="filterationColumns"
      [columnDisplayMap]="columnDisplayMap"
      (clearAllFilters)="onClearAllFilters()"
      (clearFilter)="onClearSingleFilter($event)"
      data-automation-id="applied-filters-display">
    </app-applied-filters-display>
    
      <div class="card br-14 table-responsive my-3">
        <table mat-table 
               [dataSource]="dataSource" 
               matSort
               class="g-card-table w-100"
               (matSortChange)="announceSortChange($event)">
      
            <ng-container matColumnDef="cartId">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Cart ID</th>
              <td mat-cell *matCellDef="let element" 
              (contextmenu)="onContextMenu($event, element.cartId, 'cartId')">{{ element.cartId }}</td>
            </ng-container>
      
            <ng-container matColumnDef="cartStatus">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
              <td mat-cell *matCellDef="let element" 
              (contextmenu)="onContextMenu($event, element.cartStatus, 'cartStatus')">
                <div class="d-flex align-items-center">
                  <span [ngClass]="getStatusClass(element.cartStatus)" class="br-14 label px-3 f-16">
                    {{ element.cartStatus }}
                  </span>
                </div>
              </td>
            </ng-container>
      
            <ng-container matColumnDef="statusDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="narrow-column px-4">Status Date/Time</th>
              <td mat-cell *matCellDef="let element" class="px-4">{{ element.statusDate }}</td>
            </ng-container>
      
            <ng-container matColumnDef="toteQty">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Tote Quantity</th>
              <td mat-cell *matCellDef="let element" 
              (contextmenu)="onContextMenu($event, element.toteQty, 'toteQty')">
                {{ formatToteQuantity(element.toteQty) }}
              </td>
            </ng-container>
      
            <ng-container matColumnDef="location">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
              <td mat-cell *matCellDef="let element" 
              (contextmenu)="onContextMenu($event, element.location, 'location')">{{ element.location }}</td>
            </ng-container>
      
            <ng-container matColumnDef="actions" stickyEnd>
              <th *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let selectedRecord">
                <div class="d-flex justify-content-end">
      
                  <button mat-icon-button 
                          [matMenuTriggerFor]="appMenu" 
                          aria-label="More actions for row" 
                          class="circle-icon-o" 
                          appearance="outline">
                    <mat-icon>more_horiz</mat-icon>
                  </button>
                </div>
      
                <mat-menu #appMenu="matMenu">
                  <button mat-menu-item (click)="onViewDetails(selectedRecord)">View Cart Details</button>
                  <button mat-menu-item [disabled]="(selectedRecord.cartStatus === STATUS_COMPLETE) || (selectedRecord.cartStatus === STATUS_IN_PROGRESS && selectedRecord.location !== LOCATION_IN_TRANSIT)" (click)="onEditCart(selectedRecord)">Edit</button>
                  <button mat-menu-item 
                          [disabled]="!canDeleteCart(selectedRecord)"
                          [matTooltip]="permissionMessages.NoPermission"
                          [matTooltipDisabled]="hasDeletePermission()"
                          (click)="onDeleteCart(selectedRecord)">Delete Cart</button>          
                </mat-menu>
              </td>
            </ng-container>
      
            <tr *matNoDataRow (contextmenu)="onContextMenu($event, undefined, '')">
              <td class="text-center" [attr.colspan]="displayedColumns.length">
                <div *ngIf="!isLoading && hasError" class="py-4">
                  <div class="text-center text-danger">
                    <mat-icon class="text-danger mb-2">error</mat-icon>
                    <p>Failed to load carts. Please try again.</p>
                  </div>
                </div>
                <div *ngIf="!isLoading && !hasError && dataSource.data.length === 0" class="py-4">
                  No data matching the filter.
                </div>
              </td>
            </tr>
            
            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="border"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
                [class.highlighted]="row === selectedRecord"
                (click)="onRowClick(row)"
                class="cursor-pointer"></tr>
      
          </table>
      </div>
      
      <div class="table-pagination d-flex justify-content-start align-items-center" *ngIf="displayedColumns && dataSource.data.length > 0">
        <mat-paginator [length]="customPagination.total"
                       [pageSize]="customPagination.pageSize"
                       [pageIndex]="customPagination.pageIndex"
                       showFirstLastButtons
                       [pageSizeOptions]="[10, 20, 100]"
                       (page)="onPageChange($event)"></mat-paginator>
      </div>
      <app-direct-filteration-columns-menu
  [componentName]="'cartManagement'"
  (filterationColumnsSelected)="directFilterationColumnsSelected($event)">
</app-direct-filteration-columns-menu>
    </mat-card-content>
</mat-card>