<div class="f-container">
  <app-header (toggleSidebarForMe)="sideBarToggler()" data-automation-id="app-header"> </app-header>
  <mat-sidenav-container class="main-container">
    <mat-sidenav
      #sidenav
      mode="side"
      disableClose="true"
      [opened]="sideBarOpen" data-automation-id="sidenav"
    >
      <app-side-nav [sideBarOpen]="sideBarOpen" data-automation-id="app-side-nav"></app-side-nav>
    </mat-sidenav>
    <mat-sidenav-content>
      <div
        class="dashboard-section"
        [ngClass]="{ 'side-bar-opened': sideBarOpen }"  data-automation-id="dashboard-section"
      >
        <div class="breadcrumb-menu">
          <nav aria-label="breadcrumb" class="breadcrumb" data-automation-id="breadcrumb-nav"></nav>
        </div>
        <div class="container-fluid p-0 h-auto">
          <div class="row mb-3">
            <div class="col-12">
              <mat-card class="mat-elevation-z g-card mb-4 h-100" data-automation-id="license-card">
                <mat-card-content>
                  <div class="row">
                    <div
                      class="d-flex justify-content-between align-items-center mb-2"
                    >
                      <div>
                        <app-icon-heading-component
                          heading="App Licensing"
                          icon="subtitles" [automationId]="'app-licensing-heading'"
                        >
                        </app-icon-heading-component>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-6 offset-6">
                      <div class="d-flex gap-12 mb-3 justify-content-end">
                        <button
                          (click)="addLincenseRow()"
                          mat-flat-button
                          color="primary"
                          class="add-icon-button"
                          [disabled]="addingNew" data-automation-id="add-license-button"
                        >
                          <span
                            class="material-symbols-outlined"
                            matTooltip="Add License"
                            matTooltipPosition="above"
                          >
                            add
                          </span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div
                    class="card br-14 table-responsive my-3 borderless h-500px"
                  >
                    <ng-scrollbar
                      track="all"
                      class="mat-table-scrollbar h-500px" data-automation-id="table-scrollbar"
                    >
                      <table
                        mat-table
                        [dataSource]="dataSource"
                        class="custom-table table-fix" data-automation-id="license-table"
                      >
                        <!-- Position Column -->
                        <ng-container matColumnDef="appname">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="appname-header">App Name</th>
                          <td mat-cell *matCellDef="let element; let index = index" [attr.data-automation-id]="'appname-cell-'+index">
                            <div class="pe-2">
                              <mat-form-field class="custom-form-field w-100" appearance="outline">
                                <input
                                  #printerNameInput
                                  matInput
                                  type="text"
                                  maxlength="50"
                                  [(ngModel)]="element.appname"
                                  (ngModelChange)="onInputValueChange(index)"
                                  [disabled]="!element.isNewRow" [attr.data-automation-id]="'appname-input-'+index"
                                />
                              </mat-form-field>
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="displayname">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="displayname-header">
                            Display Name
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element; let index = index" [attr.data-automation-id]="'displayname-cell-'+index"
                          >
                            <div class="pe-2">
                              <mat-form-field
                                class="custom-form-field w-100"
                                appearance="outline"
                              >
                                <input
                                  matInput
                                  type="text"
                                  #specialFeature
                                  maxlength="50"
                                  [value]="element.displayname"
                                  [(ngModel)]="element.displayname"
                                  (ngModelChange)="
                                    onInputValueChange(index)
                                  "
                                  [value]="element.displayname"  [attr.data-automation-id]="'displayname-input-'+index"
                                />
                              </mat-form-field>
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="license">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="license-header">License</th>
                          <td
                            mat-cell
                            *matCellDef="let element; let index = index"  [attr.data-automation-id]="'license-cell-'+index"
                          >
                            <div class="pe-2">
                              <mat-form-field
                                class="custom-form-field w-100"
                                appearance="outline"
                              >
                                <input
                                  matInput
                                  type="text"
                                  #specialFeature
                                  maxlength="255"
                                  [value]="element.license"
                                  [(ngModel)]="element.license"
                                  (ngModelChange)="
                                    onInputValueChange(index)
                                  "
                                  [value]="element.license"  [attr.data-automation-id]="'license-input-'+index"
                                />
                              </mat-form-field>
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="numlicense">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="numlicense-header">
                            Num. Licenses
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element; let index = index"  [attr.data-automation-id]="'numlicense-cell-'+index"
                          >
                            <div class="pe-2">
                              <mat-form-field
                                class="custom-form-field w-100"
                                appearance="outline"
                              >
                                <input
                                  matInput
                                  disabled
                                  type="text"
                                  #specialFeature
                                  maxlength="255"
                                  [value]="element.numlicense"
                                  [(ngModel)]="element.numlicense"
                                  (ngModelChange)="
                                    onInputValueChange(index)
                                  "
                                  [value]="element.numlicense" [attr.data-automation-id]="'numlicense-input-'+index"
                                />
                              </mat-form-field>
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="status">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="status-header">Status</th>
                          <td
                            mat-cell
                            *matCellDef="let element; let index = index" [attr.data-automation-id]="'status-cell-'+index"
                          >
                            <div class="d-flex pe-2 align-items-center">
                              <span
                                class="d-flex align-items-center label px-2"
                                [ngClass]="{
                                  'label-green': element.status === 'Valid',
                                  'label-red': element.status === 'Invalid'
                                }" [attr.data-automation-id]="'status-label-'+index+'-'+element.status"
                                >{{ element.status }}</span
                              >
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="appurl">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="appurl-header">App URL</th>
                          <td mat-cell *matCellDef="let element; let index = index" [attr.data-automation-id]="'appurl-cell-'+index">
                            <div class="pe-2">
                              <mat-form-field class="custom-form-field w-100" appearance="outline">
                                <input
                                  matInput
                                  type="text"
                                  maxlength="50"
                                  [(ngModel)]="element.appurl"
                                  (ngModelChange)="onInputValueChange(index)" [attr.data-automation-id]="'appurl-input-'+index"
                                />
                              </mat-form-field>
                            </div>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="save">
                          <th mat-header-cell *matHeaderCellDef data-automation-id="actions-header"></th>
                          <td mat-cell *matCellDef="let element; let i = index" [attr.data-automation-id]="'actions-cell-'+i">
                            <div class="d-flex gap-12 align-items-center">
                              <button (click)="saveLicense(element)" mat-flat-button color="primary" class="xsm-icon-button mb-2" [disabled]="isSaveDisabled(element)" [attr.data-automation-id]="'save-button-'+i">
                                <mat-icon class="material-symbols-outlined" matTooltip="Save" matTooltipPosition="above">save</mat-icon>
                              </button>
                              <button mat-flat-button color="warn" class="xsm-icon-button mb-2" (click)="removeLicense(element)" [attr.data-automation-id]="'delete-button-'+i">
                                <mat-icon class="material-symbols-outlined" matTooltip="Delete" matTooltipPosition="above">close</mat-icon>
                            </button>
                            </div>
                          </td>
                        </ng-container>

                        <tr
                          mat-header-row
                          *matHeaderRowDef="displayedColumns; sticky: true" data-automation-id="table-header-row"
                        ></tr>
                        <tr
                          mat-row
                          *matRowDef="let row; columns: displayedColumns"
                        ></tr>
                      </table>
                    </ng-scrollbar>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </div>
        <router-outlet data-automation-id="router-outlet"></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
