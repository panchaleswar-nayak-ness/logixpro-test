<div class="d-flex justify-content-between mb-4 align-items-center">
    <div class="w-48px"></div>
    <h1 class="m-0" mat-dialog-title data-automation-id="heading-shipping">Shipping</h1>
    <button mat-icon-button class="close-button dialog-close-button-fix" [mat-dialog-close]="true" data-automation-id="close-dialog-button">
        <mat-icon class="close-icon">close</mat-icon>
    </button>
</div>
<div matDialogContent>

    <div class="mb-3 card p-3">

            <div class="row">
                <div class="col-xl-4" *ngIf="orderShipHidden">
                    <mat-form-field class="custom-form-field custom-form-field-bg-white w-100" appearance="outline">
                        <mat-label data-automation-id="label-order-number">Order Number</mat-label>
                        <input type="text" aria-label="Search" matInput [(ngModel)]="orderNumber" disabled data-automation-id="input-order-number">
                    </mat-form-field>
                </div>
                <div  class="col-xl-5" *ngIf="!orderShipHidden">
                    <div class="chip-container">
                        <mat-form-field class="custom-form-field custom-form-field-bg-white w-100" appearance="outline">
                            <mat-label data-automation-id="label-order-number">Order Number</mat-label>
                            <mat-chip-list #chipList aria-label="Order Selection" class="custom-form-field-bg-white w-100">
                              <mat-chip
                                *ngFor="let order of selectedOrders; let i = index"
                                [selectable]="true"
                                [removable]="true"
                                (removed)="removeOrder(order)"
                                class="bg-light-blue" [attr.data-automation-id]="'order-chip-' + order"
                              >
                                {{ order }}
                                <button matChipRemove [attr.data-automation-id]="'remove-order-chip-' + i">
                                  <mat-icon class="bold text-16 lh-20">close_small</mat-icon>
                                </button>
                              </mat-chip>
                              <input
                                #chipInput
                                [formControl]="itemControl"
                                [matAutocomplete]="auto"
                                [matChipInputFor]="chipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                [matChipInputAddOnBlur]="false"
                                (matChipInputTokenEnd)="addOrderFromInput($event, chipInput)" data-automation-id="input-order-chip"
                              />
                            </mat-chip-list>
                            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addOrderFromAutocomplete($event, chipInput)">
                                <mat-option *ngFor="let order of filteredOrders | async; let i = index" [value]="order" [attr.data-automation-id]="'order-option-' + i + '-' + order">
                                    {{ order }}
                                  </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                      </div>
                      
                      
                </div>
            </div>
        
    </div>
    <div class="mb-2 card p-3">
        <div class="d-flex justify-content-between">
            <h2 class="card-header-title mb-3 d-flex align-items-center" data-automation-id="heading-shipment">
                <div class="mat-icon-wrap me-lg-3">
                    <span class="material-symbols-outlined">
                        repartition
                    </span>
                </div>
                <span>Shipment</span>
            </h2>
            <div class="d-block d-xl-flex justify-content-end gap-12">
            <button
            (click)="openCmAddNewItem()"
            [disabled]="shippingComp"
        mat-flat-button
        color="primary"
        class="add-icon-button mb-3" data-automation-id="add-new-container-button"
        
      >
        <span
          class="material-symbols-outlined"
          matTooltip="Add new container"
          matTooltipPosition="above"
          
          
        >
          add
        </span>
        
      </button>
      <button
        mat-button
        color="primary"
        class="icon-button secondary-button" data-automation-id="print-all-button"
        
      >
        <span
          class="material-symbols-outlined"
          mat-stroked-button
          matTooltip="Print All"
          matTooltipPosition="above"
          (click)="printAll()"
          color="primary"
        >
         print
        </span>
        
      </button>
     
    </div>
        </div>
        <ng-container >
            <mat-accordion *ngFor="let i of ContainerArray; let index = index">
              <div class="mb-2">
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title [attr.data-automation-id]="'container-panel-title-' + index"> 
                      Container ID:&nbsp;<b> {{ i.ContainerID }}</b> 
                    </mat-panel-title>
                    <mat-panel-description> </mat-panel-description>
                  </mat-expansion-panel-header>
                  <div class="row">
                    <div class="col-xl-12">
                      <div class="row">
                        <div class="col-12">
                          <div class="row">
                            <div class="col-sm-2">
                                <mat-form-field class="action-dropdown  w-100" appearance="outline">
                                    <mat-label [attr.data-automation-id]="'label-carrier-' + index">Carrier</mat-label>
                                    <mat-select #matRef class="employees-action Carrier-select" [disabled]="shippingComp"
                                    [(ngModel)]="i['Carrier']" placeholder="Carrier" [attr.data-automation-id]="'select-carrier-' + index">
                                        <mat-option *ngFor="let item of carriers; let j = index" [value]="item" [attr.data-automation-id]="'option-carrier-' + index + '-' + j + '-' + item">{{item}} </mat-option>
                                    </mat-select>
                                    <span class="material-symbols-outlined icon-expand-more">
                                        expand_more
                                    </span>
                                </mat-form-field>
                            </div>
                            <div class="col-sm-2">
                              <mat-form-field
                                class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                appearance="outline"
                              >
                                <mat-label [attr.data-automation-id]="'label-tracking-no-' + index">Tracking No.</mat-label>
                                <input [disabled]="shippingComp"
                                  type="text"
                                  [(ngModel)]="i['TrackingNumber']"
                                  matInput
                                  maxlength="50" [attr.data-automation-id]="'input-tracking-no-' + index"
                                />
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-freight-' + index">Freight</mat-label>
                                  <input [disabled]="shippingComp"
                                    type="number"
                                    oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                    [(ngModel)]="i['Freight']"
                                    matInput
                                    maxlength="200" [attr.data-automation-id]="'input-freight-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-freight1-' + index">Freight1</mat-label>
                                  <input [disabled]="shippingComp"
                                    type="number"
                                    oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                    [(ngModel)]="i['Freight1']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-freight1-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-freight2-' + index">Freight2</mat-label>
                                  <input [disabled]="shippingComp"
                                    type="number"
                                    oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                    [(ngModel)]="i['Freight2']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-freight2-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-weight-' + index">Weight</mat-label>
                                  <input [disabled]="shippingComp"
                                    type="number"
                                    oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                    [(ngModel)]="i['Weight']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-weight-' + index"
                                  />
                                </mat-form-field>
                              </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-2">
                              <mat-form-field
                                class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                appearance="outline"
                              >
                                <mat-label [attr.data-automation-id]="'label-length-' + index">Length</mat-label>
                                <input [disabled]="shippingComp"
                                  type="number"
                                  oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                  [(ngModel)]="i['Length']"
                                  matInput (keyup)="calculateCube(i)"
                                  class="counter-none"
                                  maxlength="200"  [attr.data-automation-id]="'input-length-' + index"
                                  
                                />
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2">
                              <mat-form-field
                                class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                appearance="outline"
                              >
                                <mat-label [attr.data-automation-id]="'label-width-' + index">Width</mat-label>
                                <input [disabled]="shippingComp"
                                  type="number"
                                  oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                  [(ngModel)]="i['Width']"
                                  matInput (keyup)="calculateCube(i)"
                                  maxlength="200"
                                  class="counter-none" [attr.data-automation-id]="'input-width-' + index"
                                />
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-height-' + index">Height</mat-label>
                                  <input [disabled]="shippingComp"
                                  oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                  type="number"
                                    [(ngModel)]="i['Height']"
                                    matInput (keyup)="calculateCube(i)"
                                    maxlength="200"
                                    class="counter-none"  [attr.data-automation-id]="'input-height-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-cube-' + index">Cube</mat-label>
                                  <input disabled
                                    type="number"
                                    oninput="this.value = !!this.value && Math.abs(this.value) > 0 ? Math.abs(this.value) : 0"
                                    [(ngModel)]="i['Cube']"
                                    matInput
                                    maxlength="200" [attr.data-automation-id]="'input-cube-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField1">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-user-field1-' + index">{{ shippingPreferences.userField1Alias ? shippingPreferences.userField1Alias : 'User Field 1' }}</mat-label>

                                  <input [disabled]="shippingComp"
                                    type="text"
                                    [(ngModel)]="i['UserField1']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-user-field1-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField2">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-user-field2-' + index">{{ shippingPreferences.userField2Alias ? shippingPreferences.userField2Alias : 'User Field 2' }}</mat-label>

                                  <input [disabled]="shippingComp"
                                    type="text"
                                    [(ngModel)]="i['UserField2']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-user-field2-' + index"
                                  />
                                </mat-form-field>
                              </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField3">
                              <mat-form-field
                                class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                appearance="outline"
                              >
                               <mat-label [attr.data-automation-id]="'label-user-field3-' + index">{{ shippingPreferences.userField3Alias ? shippingPreferences.userField3Alias : 'User Field 3' }}</mat-label>

                                <input [disabled]="shippingComp"
                                  type="text"
                                  [(ngModel)]="i['UserField3']"
                                  matInput
                                  maxlength="200"  [attr.data-automation-id]="'input-user-field3-' + index"
                                  
                                />
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField4">
                              <mat-form-field
                                class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                appearance="outline"
                              >
                                <mat-label [attr.data-automation-id]="'label-user-field4-' + index">{{ shippingPreferences.userField4Alias ? shippingPreferences.userField4Alias : 'User Field 4' }}</mat-label>

                                <input [disabled]="shippingComp"
                                  type="text"
                                  [(ngModel)]="i['UserField4']"
                                  matInput
                                  maxlength="200"   [attr.data-automation-id]="'input-user-field4-' + index"
                                />
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField5">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-user-field5-' + index">{{ shippingPreferences.userField5Alias ? shippingPreferences.userField5Alias : 'User Field 5' }}</mat-label>

                                  <input [disabled]="shippingComp"
                                    type="text"
                                    [(ngModel)]="i['UserField5']"
                                    matInput
                                    maxlength="200"   [attr.data-automation-id]="'input-user-field5-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField6">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-user-field6-' + index">{{ shippingPreferences.userField6Alias ? shippingPreferences.userField6Alias : 'User Field 6' }}</mat-label>

                                  <input [disabled]="shippingComp"
                                    type="text"
                                    [(ngModel)]="i['UserField6']"
                                    matInput
                                    maxlength="200"   [attr.data-automation-id]="'input-user-field6-' + index"
                                  />
                                </mat-form-field>
                              </div>
                              <div class="col-sm-2" *ngIf="shippingPreferences && shippingPreferences.userField7">
                                <mat-form-field
                                  class="custom-form-field custom-form-field-bg-white w-100 mb-3"
                                  appearance="outline"
                                >
                                  <mat-label [attr.data-automation-id]="'label-user-field7-' + index">{{ shippingPreferences.userField7Alias ? shippingPreferences.userField7Alias : 'User Field 7' }}</mat-label>

                                  <input [disabled]="shippingComp"
                                    type="text"
                                    [(ngModel)]="i['UserField7']"
                                    matInput
                                    maxlength="200"  [attr.data-automation-id]="'input-user-field7-' + index"
                                  />
                                </mat-form-field>
                              </div>
                             
                          </div>
                          <div class="row">
                            <div class="d-block d-xl-flex justify-content-end">
                                <div class="d-xl-flex gap-12">
                                    <button  mat-stroked-button class="mb-3 mb-xl-0 form-button-submit m-1 m-xl-0"
                                            color="primary" (click)="PrintItem('',i)" [attr.data-automation-id]="'print-button-' + index">Print</button>
                                    <button  mat-stroked-button [disabled]="shippingComp"  class="mb-3 mb-xl-0 button-remove-all-w-stroke m-1 m-xl-0"
                                            color="warn" (click)="DeleteItem('',i)" [attr.data-automation-id]="'delete-button-' + index">Delete</button>
                                    <button  mat-flat-button [disabled]="shippingComp" class="mb-3 mb-xl-0 form-button-submit m-1 m-xl-0"
                                            color="primary" (click)="updateShipmentItem(i)" [attr.data-automation-id]="'save-button-' + index">Save</button>
                                  </div>
                                
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-expansion-panel>
              </div>
            </mat-accordion>
          </ng-container>
    </div>
   
</div>

  
<div matDialogActions>
    <button type="button" mat-flat-button color="primary" class="mb-2 btn-lg w-100" [disabled]="shippingComp"
        (click)="ShippingCompShip()" data-automation-id="complete-shipment-button">Complete Shipment</button>
</div>